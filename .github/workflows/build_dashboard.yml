#name: prod_build_www
#
#env:
#  ACTIONS_ALLOW_UNSECURE_COMMANDS: true
#  working_directory: ./www
#  github_token: ${{ secrets.ghub_token }}
#  docker_pass: ${{ secrets.docker_pass }}
#  basion_host: ${{ secrets.basion_host }}
#  basion_user: ${{ secrets.basion_user }}
#  basion_user_private_key: ${{ secrets.basion_user_private_key}}
#  CI: true
#on:
#  push:
#    branches:
#      - master
#    paths:
#      - 'www/**'
#      - '.github/**'
#
#jobs:
#
#  build:
#    name: build www
#    runs-on: ubuntu-latest
#    #    needs: [lint_config]
#    steps:
#      - name: Check out source code
#        uses: actions/checkout@v2
#
#      - name: General
#        run: |
#          # comment
#          GIT_BRANCH=${{ github.ref }}
#          echo ::set-env name=GH_SHA_SHORT::$(echo $GITHUB_SHA | cut -c 1-7)
#
#      - name: Build Image
#        working-directory: ${{env.working_directory}}
#        run: |
#
#          docker login --username devypt -p ${docker_pass}
#          docker build -t www -f Dockerfile . --build-arg BUILD_COMMIT=$GITHUB_SHA
#
#      - name: Push Image
#        working-directory: ${{env.working_directory}}
#        run: |
#          docker tag www devypt/shop-www:prod-$GH_SHA_SHORT
#          docker push devypt/shop-www:prod-$GH_SHA_SHORT
#
#          docker tag www devypt/shop-www:latest-prod
#          docker push devypt/shop-www:latest-prod
#
#      - name: executing remote ssh commands using ssh key
#        uses: appleboy/ssh-action@master
#        env:
#          SHA: ${{env.GH_SHA_SHORT}}
#        with:
#          host: ${{ env.basion_host }}
#          username: ${{ env.basion_user }}
#          key: ${{ env.basion_user_private_key }}
#          envs: SHA
#          script: |
#            cd ~/devops/ && ansible-playbook install-app.yaml --extra-vars "app=www tag=prod-$SHA"
